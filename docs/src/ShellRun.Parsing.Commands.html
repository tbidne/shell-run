<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ImportQualifiedPost #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- | Provides functionality for translating 'Text' commands</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- via a 'LegendMap'.</span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">ShellRun.Parsing.Commands</span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="ShellRun.Parsing.Commands.html#translateCommands"><span class="hs-identifier">translateCommands</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier">Data.Text.Lazy</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LazyT</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier">Data.Text.Lazy.Builder</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier">Builder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier">Data.Text.Lazy.Builder</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LTBuilder</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="ShellRun.Types.Command.html"><span class="hs-identifier">ShellRun.Types.Command</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ShellRun.Types.Command.html#Command"><span class="hs-identifier">Command</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="ShellRun.Types.Legend.html"><span class="hs-identifier">ShellRun.Types.Legend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ShellRun.Types.Legend.html#LegendErr"><span class="hs-identifier">LegendErr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ShellRun.Types.Legend.html#LegendMap"><span class="hs-identifier">LegendMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="ShellRun.Utils.html"><span class="hs-identifier">ShellRun.Utils</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Utils</span></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-comment">-- | Returns a list of 'Text' commands, potentially transforming a</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- given string via the `LegendMap` @legend@.</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- Given a command string /s/, we first check if /s/ exists as a key in</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- @legend@. If it does not, we return /s/. If there is a key matching</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- /s/, i.e.,</span><span>
</span><span id="line-28"></span><span class="hs-comment">--</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- legend = fromList [...,(s, v),...]</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-32"></span><span class="hs-comment">--</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- where \(v = v_1,,\ldots,,v_n\), then we recursively search on each</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- \(v_i\). We stop and return \(v_i\) when it does not exist as a key in the</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- map.</span><span>
</span><span id="line-36"></span><span class="hs-comment">--</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-38"></span><span class="hs-comment">--</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><span id="line-40"></span><span class="hs-comment">--   let m = Map.fromList</span><span>
</span><span id="line-41"></span><span class="hs-comment">--         [ (&quot;cmd1&quot;, &quot;one&quot;),</span><span>
</span><span id="line-42"></span><span class="hs-comment">--           (&quot;cmd2&quot;, &quot;two&quot;),</span><span>
</span><span id="line-43"></span><span class="hs-comment">--           (&quot;all&quot;, &quot;cmd1,,cmd2,,other&quot;)</span><span>
</span><span id="line-44"></span><span class="hs-comment">--         ]</span><span>
</span><span id="line-45"></span><span class="hs-comment">--       cmds = translateCommands m [&quot;all&quot;,&quot;blah&quot;]</span><span>
</span><span id="line-46"></span><span class="hs-comment">--   in (fmap . fmap) getCommand cmds</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- :}</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- Right [&quot;one&quot;,&quot;two&quot;,&quot;other&quot;,&quot;blah&quot;]</span><span>
</span><span id="line-49"></span><span class="hs-comment">--</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- Note: If -- when looking up a line -- we detect a cycle, then a 'CyclicKeyErr'</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- will be returned.</span><span>
</span><span id="line-52"></span><span class="hs-comment">--</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- &gt;&gt;&gt; :{</span><span>
</span><span id="line-54"></span><span class="hs-comment">--   let m = Map.fromList</span><span>
</span><span id="line-55"></span><span class="hs-comment">--         [ (&quot;a&quot;, &quot;b&quot;),</span><span>
</span><span id="line-56"></span><span class="hs-comment">--           (&quot;b&quot;, &quot;c&quot;),</span><span>
</span><span id="line-57"></span><span class="hs-comment">--           (&quot;c&quot;, &quot;a&quot;)</span><span>
</span><span id="line-58"></span><span class="hs-comment">--         ]</span><span>
</span><span id="line-59"></span><span class="hs-comment">--   in translateCommands m [&quot;a&quot;]</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- :}</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- Left (CyclicKeyErr &quot;a -&gt; b -&gt; c -&gt; a&quot;)</span><span>
</span><span id="line-62"></span><span class="annot"><a href="ShellRun.Parsing.Commands.html#translateCommands"><span class="hs-identifier hs-type">translateCommands</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ShellRun.Types.Legend.html#LegendMap"><span class="hs-identifier hs-type">LegendMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="ShellRun.Types.Legend.html#LegendErr"><span class="hs-identifier hs-type">LegendErr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ShellRun.Types.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-63"></span><span id="translateCommands"><span class="annot"><span class="annottext">translateCommands :: LegendMap -&gt; [Text] -&gt; Either LegendErr [Command]
</span><a href="ShellRun.Parsing.Commands.html#translateCommands"><span class="hs-identifier hs-var hs-var">translateCommands</span></a></span></span><span> </span><span id="local-6989586621679068357"><span class="annot"><span class="annottext">LegendMap
</span><a href="#local-6989586621679068357"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either LegendErr Command] -&gt; Either LegendErr [Command]
forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Traversable t, Applicative f) =&gt;
t (f a) -&gt; f (t a)
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">sequenceA</span></a></span><span> </span><span class="annot"><span class="annottext">([Either LegendErr Command] -&gt; Either LegendErr [Command])
-&gt; ([Text] -&gt; [Either LegendErr Command])
-&gt; [Text]
-&gt; Either LegendErr [Command]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Either LegendErr Command])
-&gt; [Text] -&gt; [Either LegendErr Command]
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LegendMap -&gt; Text -&gt; [Either LegendErr Command]
</span><a href="ShellRun.Parsing.Commands.html#lineToCommands"><span class="hs-identifier hs-var">lineToCommands</span></a></span><span> </span><span class="annot"><span class="annottext">LegendMap
</span><a href="#local-6989586621679068357"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="annot"><a href="ShellRun.Parsing.Commands.html#lineToCommands"><span class="hs-identifier hs-type">lineToCommands</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ShellRun.Types.Legend.html#LegendMap"><span class="hs-identifier hs-type">LegendMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="ShellRun.Types.Legend.html#LegendErr"><span class="hs-identifier hs-type">LegendErr</span></a></span><span> </span><span class="annot"><a href="ShellRun.Types.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-66"></span><span id="lineToCommands"><span class="annot"><span class="annottext">lineToCommands :: LegendMap -&gt; Text -&gt; [Either LegendErr Command]
</span><a href="ShellRun.Parsing.Commands.html#lineToCommands"><span class="hs-identifier hs-var hs-var">lineToCommands</span></a></span></span><span> </span><span id="local-6989586621679068352"><span class="annot"><span class="annottext">LegendMap
</span><a href="#local-6989586621679068352"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Text -&gt; Builder -&gt; Text -&gt; [Either LegendErr Command]
</span><a href="#local-6989586621679068351"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Set Text
forall a. Set a
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">Set.empty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-var">LTBuilder.fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-comment">-- The stringbuilder path is a textual representation of the key path</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-comment">-- we have traversed so far, e.g., a -&gt; b -&gt; c</span><span>
</span><span id="line-70"></span><span>    </span><span id="local-6989586621679068351"><span class="annot"><span class="annottext">go :: Set Text -&gt; Builder -&gt; Text -&gt; [Either LegendErr Command]
</span><a href="#local-6989586621679068351"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679068348"><span class="annot"><span class="annottext">Set Text
</span><a href="#local-6989586621679068348"><span class="hs-identifier hs-var">foundKeys</span></a></span></span><span> </span><span id="local-6989586621679068347"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679068347"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621679068346"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068346"><span class="hs-identifier hs-var">line</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; LegendMap -&gt; Maybe Text
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068346"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="annot"><span class="annottext">LegendMap
</span><a href="#local-6989586621679068352"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-71"></span><span>      </span><span class="hs-comment">-- The line isn't a key, return it.</span><span>
</span><span id="line-72"></span><span>      </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Command -&gt; Either LegendErr Command
forall a b. b -&gt; Either a b
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Command
</span><a href="ShellRun.Types.Command.html#MkCommand"><span class="hs-identifier hs-var">MkCommand</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068346"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-73"></span><span>      </span><span class="hs-comment">-- The line is a key, check for cycles and recursively</span><span>
</span><span id="line-74"></span><span>      </span><span class="hs-comment">-- call.</span><span>
</span><span id="line-75"></span><span>      </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679068343"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068343"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679068342"><span class="hs-identifier hs-var">maybeCyclicVal</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679068341"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068341"><span class="hs-identifier hs-var">cyclicVal</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-77"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068340"><span class="annot"><span class="annottext">pathTxt :: Text
</span><a href="#local-6989586621679068340"><span class="hs-identifier hs-var hs-var">pathTxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Text -&gt; Text -&gt; Text
</span><a href="ShellRun.Parsing.Commands.html#builderToPath"><span class="hs-identifier hs-var">builderToPath</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679068347"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068346"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068341"><span class="hs-identifier hs-var">cyclicVal</span></a></span><span>
</span><span id="line-78"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LegendErr -&gt; Either LegendErr Command
forall a b. a -&gt; Either a b
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; LegendErr
</span><a href="ShellRun.Types.Legend.html#CyclicKeyErr"><span class="hs-identifier hs-var">CyclicKeyErr</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068340"><span class="hs-identifier hs-var">pathTxt</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-79"></span><span>        </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679068337"><span class="hs-identifier hs-var">cmds</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
-&gt; (Text -&gt; [Either LegendErr Command])
-&gt; [Either LegendErr Command]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Set Text -&gt; Builder -&gt; Text -&gt; [Either LegendErr Command]
</span><a href="#local-6989586621679068351"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Set Text
</span><a href="#local-6989586621679068336"><span class="hs-identifier hs-var">foundKeys'</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679068335"><span class="hs-identifier hs-var">path'</span></a></span><span>
</span><span id="line-80"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-81"></span><span>          </span><span class="hs-comment">-- WARN: Using a double comma right now as a delimiter. Hoping</span><span>
</span><span id="line-82"></span><span>          </span><span class="hs-comment">-- this isn't a thing that appears in real bash commands...</span><span>
</span><span id="line-83"></span><span>          </span><span id="local-6989586621679068337"><span class="annot"><span class="annottext">cmds :: [Text]
</span><a href="#local-6989586621679068337"><span class="hs-identifier hs-var hs-var">cmds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [Text]
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-var">T.splitOn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,,&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068343"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-84"></span><span>          </span><span id="local-6989586621679068336"><span class="annot"><span class="annottext">foundKeys' :: Set Text
</span><a href="#local-6989586621679068336"><span class="hs-identifier hs-var hs-var">foundKeys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Set Text -&gt; Set Text
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068346"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="annot"><span class="annottext">Set Text
</span><a href="#local-6989586621679068348"><span class="hs-identifier hs-var">foundKeys</span></a></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span>          </span><span class="hs-comment">-- Detect if we have an intersection between previously found</span><span>
</span><span id="line-87"></span><span>          </span><span class="hs-comment">-- keys and the values we just found. If so we have found a</span><span>
</span><span id="line-88"></span><span>          </span><span class="hs-comment">-- cyclic error.</span><span>
</span><span id="line-89"></span><span>          </span><span id="local-6989586621679068332"><span class="annot"><span class="annottext">intersect :: Set Text
</span><a href="#local-6989586621679068332"><span class="hs-identifier hs-var hs-var">intersect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Text -&gt; Set Text -&gt; Set Text
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">Set.intersection</span></a></span><span> </span><span class="annot"><span class="annottext">Set Text
</span><a href="#local-6989586621679068348"><span class="hs-identifier hs-var">foundKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Set Text
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679068337"><span class="hs-identifier hs-var">cmds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>          </span><span class="hs-comment">-- If there are cycles then this should be `Just cyclicVal`</span><span>
</span><span id="line-91"></span><span>          </span><span class="hs-comment">-- (this list should have at most one since we are detecting</span><span>
</span><span id="line-92"></span><span>          </span><span class="hs-comment">-- the first cycle)</span><span>
</span><span id="line-93"></span><span>          </span><span id="local-6989586621679068342"><span class="annot"><span class="annottext">maybeCyclicVal :: Maybe Text
</span><a href="#local-6989586621679068342"><span class="hs-identifier hs-var hs-var">maybeCyclicVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Maybe Text
forall a. [a] -&gt; Maybe a
</span><a href="ShellRun.Utils.html#headMaybe"><span class="hs-identifier hs-var">Utils.headMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Maybe Text) -&gt; [Text] -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set Text -&gt; [Text]
forall a. Set a -&gt; [a]
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set Text
</span><a href="#local-6989586621679068332"><span class="hs-identifier hs-var">intersect</span></a></span><span>
</span><span id="line-94"></span><span>          </span><span id="local-6989586621679068335"><span class="annot"><span class="annottext">path' :: Builder
</span><a href="#local-6989586621679068335"><span class="hs-identifier hs-var hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679068347"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-var">LTBuilder.fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068346"><span class="hs-identifier hs-var">line</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot; -&gt; &quot;</span></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="annot"><a href="ShellRun.Parsing.Commands.html#builderToPath"><span class="hs-identifier hs-type">builderToPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-type">Builder</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-97"></span><span id="builderToPath"><span class="annot"><span class="annottext">builderToPath :: Builder -&gt; Text -&gt; Text -&gt; Text
</span><a href="ShellRun.Parsing.Commands.html#builderToPath"><span class="hs-identifier hs-var hs-var">builderToPath</span></a></span></span><span> </span><span id="local-6989586621679068327"><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679068327"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621679068326"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068326"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679068325"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068325"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-var">LazyT.toStrict</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="annottext">Builder -&gt; Text
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-var">LTBuilder.toLazyText</span></a></span><span> </span><span class="annot"><span class="annottext">(Builder -&gt; Text) -&gt; Builder -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-100"></span><span>      </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679068327"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-var">LTBuilder.fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068326"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Builder
</span><span class="hs-string">&quot; -&gt; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Builder -&gt; Builder -&gt; Builder
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/base-4.14.1.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Builder
</span><a href="../file:///nix/store/4l5b66ldx9lhqairv5ahc11kcmbp9904-ghc-8.10.4-doc/share/doc/ghc/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-var">LTBuilder.fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679068325"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-101"></span></pre></body></html>